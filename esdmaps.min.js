!function(e,t){"undefined"!=typeof exports?t(0,exports,null):e.ESDMaps=t(0,e.ESDMaps||{},e.L)}(this,function(e,n,a){n.VERSION="0.0.1";var s=n.settings={mapboxId:"esd.ExcellentSchoolsDetroit",altPopupClass:"esdmaps-alt-popup",altPopupOpenClass:"esdmaps-alt-popup-open",baseUrl:"//static.excellentschoolsdetroit.org/libs/esdmaps-js",selectedMarkerColor:"#124472"};function i(e,t){for(var o=0;o<e.length;o++)t(e[o],o)}function p(e,t){e.classList?e.classList.add(t):e.className+=" "+t}n._presets={};var t=n.registerPreset=function(e,t){n._presets[e]=t},l=n.getPreset=function(e){return n._presets[e]};function u(e,t){var r,o;void 0===t.altPopup?((o=document.createElement("div")).setAttribute("id","esdmaps-alt-popup"),r=o,container=e.getContainer(),container.parentNode.insertBefore(r,container.nextSibling)):r="string"==typeof t.altPopup?document.querySelector("#"+t.altPopup):t.altPopup,r&&(p(r,s.altPopupClass),e.on("popupopen",function(e){r.innerHTML=e.popup.getContent(),p(r,s.altPopupOpenClass)}),e.on("popupclose",function(e){var t,o;r.innerHTML="",o=s.altPopupOpenClass,(t=r).classList?t.classList.remove(o):t.className=t.className.replace(new RegExp("(^|\\b)"+o.split(" ").join("|")+"(\\b|$)","gi")," ")}))}function c(t,e,r){var o,p,n;return o=e,p=function(e){a.geoJson(e,{pointToLayer:a.mapbox.marker.style,style:function(e){return e.properties},onEachFeature:function(e,t){var o;t.bindPopup(m(r.popupTemplate,e.properties)),t.on("popupopen",function(e){e=e.target;e.feature.properties["old-color"]=e.feature.properties["marker-color"],e.feature.properties["marker-color"]=s.selectedMarkerColor,e.setIcon(a.mapbox.marker.icon(e.feature.properties))}),t.on("popupclose",function(e){e=e.target;e.feature.properties["marker-color"]=e.feature.properties["old-color"],e.setIcon(a.mapbox.marker.icon(e.feature.properties))}),r.showPopupOnHover&&(o=r,(t=t).on("mouseover",function(e){var t=e.target.getPopup();e.target._hovering=!0,o.hoverPopupTemplate&&t.setContent(m(o.hoverPopupTemplate,e.target.feature.properties)),e.target.openPopup(),a.DomUtil.addClass(t._container,"esdmaps-hover")}),t.on("mouseout",function(e){var t;e.target._hovering&&(t=e.target.getPopup(),e.target._hovering=!1,a.DomUtil.removeClass(t._container,"esdmaps-hover"),e.target.closePopup())}),t.on("click",function(e){var t;e.target._hovering&&(t=e.target.getPopup(),e.target._hovering=!1,o.hoverPopupTemplate&&t.setContent(m(o.popupTemplate,e.target.feature.properties)),e.target.openPopup(),a.DomUtil.removeClass(t._container,"esdmaps-hover"))}))}}).addTo(t)},(e=new XMLHttpRequest).open("GET",o,!0),e.onreadystatechange=function(){4===this.readyState&&(200<=this.status&&this.status<400?p(JSON.parse(this.responseText)):n&&n())},e.send(),e=null,t}function m(e,t){return"string"==typeof e?a.mapbox.template(e,t):"function"==typeof e?e(t):""}function o(e){var o,r,t,p=(o=e,r={},i(["preset","alt-popup","points-url","zoom","center"],function(e){var t="data-"+e;o.hasAttribute(t)&&(r[e]=o.getAttribute(t))}),r);p.center&&(t=p.center.split(","),p.center=a.latLng(parseFloat(t[0]),parseFloat(t[1]))),n.map(e,p.preset,{altPopup:p["alt-popup"],pointsUrl:p["points-url"],zoom:p.zoom,center:p.center})}n.map=function(e,t,o){o=o||{};var r,p,n=l(t),t=n?(o=function(o){return i(Array.prototype.slice.call(arguments,1),function(e){for(var t in e)void 0===o[t]&&(o[t]=e[t])}),o}(o,(r=n,p={},i(["zoom","center","popupTemplate","pointsUrl","showPopupOnHover","hoverPopupTemplate"],function(e){r[e]&&(p[e]=r[e])}),p)),a.mapbox.map(e,n.mapboxId,o)):a.mapbox.map(e,t||s.mapboxId,o);return u(t,o),o.pointsUrl&&c(t,o.pointsUrl,o),t};var r=n.detectMaps=function(){i(document.querySelectorAll(".esdmaps-map"),o)};return t("recommended-schools-k-8-2014",{mapboxId:s.mapboxId,center:a.latLng(42.3484,-83.058),zoom:13,pointsUrl:s.baseUrl+"/data/recommended-k-8-schools-2014-spring.json",popupTemplate:"<div><h2>{{schoolname}}</h2><p>{{grades}}<br>{{address}}<br>Call: {{phone}}<br><a href='{{scorecard-url}}' target='_blank'>See more detail</a></p></div>",showPopupOnHover:!0,hoverPopupTemplate:"<h2>{{schoolname}}</h2>"}),r(),n});
//# sourceMappingURL=esdmaps.min.js.map